const { createCanvas, loadImage } = require('canvas');
const { wrapText } = require('../functions/canvas');

async function tuxedopooh(normal, tuxedo) {
    if (!normal || tuxedo) throw new Error(`Please provide a normal and a tuxedo texts.`)

    try {
        const base = await loadImage(`https://raw.githubusercontent.com/caseyCantCode/discordImageGenImages/main/tuxedo-pooh.png`);
        const canvas = createCanvas(base.width, base.height);
        const ctx = canvas.getContext('2d');
        ctx.drawImage(base, 0, 0);
        ctx.textAlign = 'center';
        ctx.textBaseline = 'top';
        ctx.font = "50px Arial"
        let fontSize = 50;
        while (ctx.measureText(normal).width > 1320) {
            fontSize--;
            ctx.font = `${fontSize}px Arial`
        }
        const normalLines = await wrapText(ctx, normal, 440);
        const normalTopMost = 145 - (((fontSize * normalLines.length) / 2) + ((10 * (normalLines.length - 1)) / 2));
        for (let i = 0; i < normalLines.length; i++) {
            const height = normalTopMost + ((fontSize + 10) * i);
            ctx.fillText(normalLines[i], 570, height);
        }
        ctx.font = "50px Arial"
        fontSize = 50;
        while (ctx.measureText(tuxedo).width > 1320) {
            fontSize--;
            ctx.font = `${fontSize}px Arial`;
        }
        const tuxedoLines = await wrapText(ctx, tuxedo, 440);
        const tuxedoTopMost = 436 - (((fontSize * tuxedoLines.length) / 2) + ((10 * (tuxedoLines.length - 1)) / 2));
        for (let i = 0; i < tuxedoLines.length; i++) {
            const height = tuxedoTopMost + ((fontSize + 10) * i);
            ctx.fillText(tuxedoLines[i], 570, height);
        }
        return canvas.toBuffer()
    } catch (err) {
        throw new Error(`Sorry there was an error: ${err}`)
    }
}
module.exports = tuxedopooh