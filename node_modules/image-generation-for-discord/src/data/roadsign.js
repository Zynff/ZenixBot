const { createCanvas, loadImage, registerFont } = require('canvas');
const path = require('path');
const { wrapText } = require('../functions/canvas');
registerFont(path.join(__dirname, '..', 'assets', 'fonts', 'EHSMB.ttf'), { family: 'Electronic Highway Sign' });

async function roadsign(text) {
    if (!text) throw new Error(`Please provide some text.`)

    const base = await loadImage(`https://raw.githubusercontent.com/caseyCantCode/discordImageGenImages/main/highway-sign.png`);
    const canvas = createCanvas(base.width, base.height);
    const ctx = canvas.getContext('2d');
    ctx.drawImage(base, 0, 0);
    ctx.fillStyle = '#efe390';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'top';
    ctx.font = '18px Electronic Highway Sign';
    const lines = await wrapText(ctx, text.toUpperCase(), 178);
    if (lines.length === 1) {
        ctx.fillText(lines[0], 318, 109);
    } else if (lines.length === 2) {
        ctx.fillText(lines[0], 318, 109);
        ctx.fillText(lines[1], 318, 128);
    } else if (lines.length === 3) {
        ctx.fillText(lines[0], 318, 90);
        ctx.fillText(lines[1], 318, 109);
        ctx.fillText(lines[2], 318, 128);
    } else {
        ctx.fillText(lines[0], 318, 90);
        ctx.fillText(lines[1], 318, 109);
        ctx.fillText(lines[2], 318, 128);
        ctx.fillText(lines[3], 318, 147);
    }
    return canvas.toBuffer()
}
module.exports = roadsign