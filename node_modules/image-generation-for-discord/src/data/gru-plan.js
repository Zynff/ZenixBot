const { createCanvas, loadImage } = require('canvas');
const { wrapText } = require('../functions/canvas');
const coord = [[450, 129], [1200, 134], [450, 627], [1200, 627]];

async function gruplan(step1, step2, step3) {
    if (!step1 || !step2 || !step3) throw new Error(`Please provide 3 steps.`)

    const steps = [step1, step2, step3, step3];
    const base = await loadImage(`https://raw.githubusercontent.com/caseyCantCode/discordImageGenImages/main/gru-plan.png`);
    const canvas = createCanvas(base.width, base.height);
    const ctx = canvas.getContext('2d');
    ctx.drawImage(base, 0, 0);
    ctx.fillStyle = 'black';
    ctx.textBaseline = 'top';
    let i = 0;
    for (const [x, y] of coord) {
        ctx.font = `35px Arial`
        const step = steps[i];
        let fontSize = 35;
        while (ctx.measureText(step).width > 1100) {
            fontSize--;
            ctx.font = `${fontSize}px Arial`
        }
        const lines = await wrapText(ctx, step, 252);
        ctx.fillText(lines.join('\n'), x, y);
        i++;
    }
    return canvas.toBuffer()
}
module.exports = gruplan