const { createCanvas, loadImage } = require('canvas');
const { wrapText } = require('../functions/canvas')

async function caution(text) {
    if (!text) throw new Error(`Please provide some text.`)

    const base = await loadImage(`https://raw.githubusercontent.com/caseyCantCode/discordImageGenImages/main/caution.png`)
    const canvas = createCanvas(base.width, base.height)
    const ctx = canvas.getContext('2d')

    ctx.drawImage(base, 0, 0);
    ctx.textAlign = 'center';
    ctx.textBaseline = 'top';
    ctx.font = `60px Arial`
    let fontSize = 60;
    while (ctx.measureText(text).width > 3311) {
        fontSize--;
        ctx.font = `${fontSize}px Arial`
    }
    const lines = await wrapText(ctx, text.toUpperCase(), 895);
    const topMost = 470 - (((fontSize * lines.length) / 2) + ((20 * (lines.length - 1)) / 2));
    for (let i = 0; i < lines.length; i++) {
        const height = topMost + ((fontSize + 20) * i);
        ctx.fillText(lines[i], base.width / 2, height);
    }
    return canvas.toBuffer()
}
module.exports = caution