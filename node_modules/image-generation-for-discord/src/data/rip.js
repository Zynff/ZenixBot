const { createCanvas, loadImage, registerFont } = require('canvas');
const request = require('node-superfetch');
const path = require('path');
const { greyscale } = require('../functions/canvas');
registerFont(path.join(__dirname, '..', 'assets', 'fonts', 'CoffinStone.otf'), { family: 'Coffin Stone' });

async function rip(avatarURL) {
    if (!avatarURL) throw new Error(`Please provide a image url.`)

    try {
        var base = await loadImage(`https://raw.githubusercontent.com/caseyCantCode/discordImageGenImages/main/otherOtherRip.png`);
        var { body } = await request.get(avatarURL);
        var avatar = await loadImage(body);
        var canvas = createCanvas(base.width, base.height);
        var ctx = canvas.getContext('2d');
        ctx.drawImage(base, 0, 0);
        ctx.drawImage(avatar, 194, 399, 500, 500);
        greyscale(ctx, 194, 399, 500, 500);
        ctx.textBaseline = 'top';
        ctx.textAlign = 'center';
        ctx.font = '62px Coffin Stone';
        ctx.fillStyle = 'black';
        ctx.fillText(message.author.username, 438, 330, 500);
        ctx.fillStyle = 'white';
        if (cause) ctx.fillText(cause, 438, 910, 500);
        ctx.font = '37px Coffin Stone';
        ctx.fillText('In Loving Memory of', 438, 292);
        return canvas.toBuffer()
    } catch (err) {
        throw new Error(`Sorry there was an error: ${err}`)
    }
}
module.exports = rip