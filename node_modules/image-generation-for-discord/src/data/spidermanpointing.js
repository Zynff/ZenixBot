const { createCanvas, loadImage } = require('canvas');
const { wrapText } = require('../functions/canvas');

async function spidermanpointing(first, second) {
    if (!first || !second) throw new Error(`Please provide a first text and a second test.`)

    const base = await loadImage(`https://raw.githubusercontent.com/caseyCantCode/discordImageGenImages/main/spiderman-pointing.png`);
    const canvas = createCanvas(base.width, base.height);
    const ctx = canvas.getContext('2d');
    ctx.drawImage(base, 0, 0);
    ctx.textAlign = 'center';
    ctx.textBaseline = 'top';
    ctx.font = `50px Arial`
    ctx.fillStyle = 'white';
    let fontSize = 50;
    while (ctx.measureText(first).width > 725) {
        fontSize--;
        ctx.font = `${fontSize}px Arial`
    }
    const lines = await wrapText(ctx, first, 290);
    const topMost = 189 - (((fontSize * lines.length) / 2) + ((10 * (lines.length - 1)) / 2));
    for (let i = 0; i < lines.length; i++) {
        ctx.strokeStyle = 'black';
        ctx.lineWidth = 5;
        const height = topMost + ((fontSize + 10) * i);
        ctx.strokeText(lines[i], 222, height);
        ctx.fillText(lines[i], 222, height);
    }
    ctx.font = `50px Arial`
    fontSize = 50;
    while (ctx.measureText(second).width > 725) {
        fontSize--;
        ctx.font = `${fontSize}px Arial`
    }
    const lines2 = await wrapText(ctx, second, 290);
    const topMost2 = 190 - (((fontSize * lines2.length) / 2) + ((10 * (lines2.length - 1)) / 2));
    for (let i = 0; i < lines2.length; i++) {
        ctx.strokeStyle = 'black';
        ctx.lineWidth = 5;
        const height = topMost2 + ((fontSize + 10) * i);
        ctx.strokeText(lines2[i], 596, height);
        ctx.fillText(lines2[i], 596, height);
    }
    return canvas.toBuffer()
}
module.exports = spidermanpointing