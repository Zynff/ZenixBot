const { createCanvas, loadImage } = require('canvas');
const request = require('node-superfetch');
const { motionBlur } = require('../functions/canvas')

async function motionblur(image) {
    if (!image) throw new Error(`Please provide a image url.`)

    try {
        const { body } = await request.get(image);
        const data = await loadImage(body);
        const canvas = createCanvas(data.width, data.height);
        const ctx = canvas.getContext('2d');
        motionBlur(ctx, data, 0, 0, data.width, data.height);
        const attachment = canvas.toBuffer();
        if (Buffer.byteLength(attachment) > 8e+6) throw new Error(`Resulting image was above 8 MB.`)
        return canvas.toBuffer()
    } catch (err) {
        throw new Error(`Sorry there was an error: ${err}`)
    }
}
module.exports = motionblur