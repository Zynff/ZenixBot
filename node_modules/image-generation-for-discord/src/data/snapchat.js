const { createCanvas, loadImage } = require('canvas');
const request = require('node-superfetch');

async function snapchat(text, image) {
    if (!text || !image) throw new Error(`Please provide some text and image url.`)

    const { body } = await request.get(image);
    const base = await loadImage(body);
    const canvas = createCanvas(base.width, base.height);
    const ctx = canvas.getContext('2d');
    ctx.drawImage(base, 0, 0);
    ctx.textAlign = 'center';
    ctx.font = `${base.height / 24}px Arial`
    const barHeight = (base.height / 24) * 2;
    const barPosition = base.height - (base.height / 3);
    ctx.globalAlpha = 0.3;
    ctx.fillStyle = 'black';
    ctx.fillRect(0, barPosition - barHeight, base.width, barHeight);
    ctx.globalAlpha = 1;
    ctx.fillStyle = 'white';
    ctx.fillText(text, base.width / 2, barPosition - (barHeight * 0.4));
    return canvas.toBuffer()
}
module.exports = snapchat