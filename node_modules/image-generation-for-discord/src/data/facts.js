const { createCanvas, loadImage } = require('canvas');
const { wrapText } = require('../functions/canvas');

async function facts(fact) {
    if (!fact) throw new Error(`Please provide a fact.`)

    const base = await loadImage(`https://raw.githubusercontent.com/caseyCantCode/discordImageGenImages/main/edd-facts-book.png`);
    const canvas = createCanvas(base.width, base.height);
    const ctx = canvas.getContext('2d');
    ctx.textBaseline = 'top';
    ctx.drawImage(base, 0, 0);
    ctx.rotate(15 * (Math.PI / 180));
    ctx.font = `30px Arial`
    let fontSize = 30;
    while (ctx.measureText(fact).width > 458) {
        fontSize--;
        ctx.font = `${fontSize}px Arial`
    }
    const lines = await wrapText(ctx, fact, 183);
    ctx.fillText(lines.join('\n'), 119, 306, 183);
    ctx.rotate(-15 * (Math.PI / 180));
    return canvas.toBuffer()
}
module.exports = facts